<nav class="topbar" [class.expanded]="isMenuOpen">
  <!-- Top Bar Header (All items aligned right) -->
  <div class="bar-header">
    <!-- Admin DB Switch (Only for Admins) -->
    <ng-container *ngIf="auth.profile$ | async as profile">
      <div *ngIf="auth.isAdmin(profile)" class="db-switch" (click)="toggleDb()" [class.test-mode]="auth.isTestMode">
        <div class="knob"></div>
        <span class="switch-text">{{ auth.isTestMode ? 'TEST' : 'REAL' }}</span>
      </div>
    </ng-container>

    <!-- Logo / Brand -->
    <a routerLink="/" class="brand-logo" (click)="closeMenu()">CoLiving</a>

    <!-- Mobile/Expand Toggle -->
    <button class="menu-toggle" (click)="toggleMenu()" [class.active]="isMenuOpen" aria-label="Toggle Menu">
      <span class="bar top"></span>
      <span class="bar mid"></span>
      <span class="bar bot"></span>
    </button>
  </div>
  <!-- Expanding Menu Content -->
  <div class="menu-content" [class.open]="isMenuOpen">
    <!-- Search Bar -->
    <div class="search-wrapper">
      <div class="search-box">
        <span class="search-icon"></span>
        <input type="text" class="input-long" placeholder="驻砖 转专..." [(ngModel)]="searchTerm"
          (keyup.enter)="performSearch()">
      </div>
    </div>

    <!-- Navigation Links -->
    <div class="nav-links">
      <a routerLink="/" (click)="closeMenu()" routerLinkActive="active" [routerLinkActiveOptions]="{exact:true}">
        <span class="icon"></span> 转
      </a>
      <a routerLink="/about" (click)="closeMenu()" routerLinkActive="active">
        <span class="icon">癸</span> 转
      </a>
      <a routerLink="/search-groups" (click)="closeMenu()" routerLinkActive="active">
        <span class="icon"></span> 驻砖 砖转驻
      </a>
      <ng-container *ngIf="auth.profile$ | async as profile">
        <a *ngIf="auth.hasPermission(profile,'maskir')" routerLink="/apartments" (click)="closeMenu()" routerLinkActive="active">
          <span class="icon"></span> 专转
        </a>
      </ng-container>

      <div class="divider"></div>

      <ng-container *ngIf="user$ | async as user; else guestLinks">
        <a routerLink="/profile" (click)="closeMenu()" routerLinkActive="active" class="profile-link">
          <div class="avatar-circle">{{ (user.displayName || 'U')[0] | uppercase }}</div>
          <span class="user-name">{{ user.displayName || '驻专驻' }}</span>
        </a>
        <a (click)="logout()" class="action-link logout">
          <span class="icon"></span> 转转拽
        </a>
      </ng-container>

      <ng-template #guestLinks>
        <a (click)="openRegister(); closeMenu()" class="action-link login">
          <span class="icon"></span> 专砖 / 转专转
        </a>
      </ng-template>
    </div>
  </div>
</nav>