<section class="apartments-page">
    <h2>מאגר דירות</h2>
    <p>גלישה במודעות ששותפו על ידי הקהילה.</p>

    <div *ngIf="showRegistrationRequired">
        <show-message [message]="'אין כניסה למאגר דירות ללא הרשמה לאתר. יש להירשם לפני הצפייה במודעות.'" (closed)="showRegistrationRequired = false"></show-message>
    </div>

    <div *ngIf="!showRegistrationRequired">
        <ng-container *ngIf="auth.profile$ | async as p">
            <div class="actions-row">
                <button *ngIf="auth.hasPermission(p, 'maskir') || auth.hasPermission(p, 'admin')" class="btn btn-approve" (click)="openAddApartment()">הוסף דירה למאגר</button>
            </div>
        </ng-container>

        <div class="list">
            <div class="apt-card" *ngFor="let a of apartmentsFromDb">
                <div class="card-media">
                    <img *ngIf="getPrimaryImage(a) as img" [src]="img" alt="תמונת דירה" loading="lazy" />
                    <div *ngIf="!getPrimaryImage(a)" class="empty-image">
                        <div class="empty-frame">ללא תמונה כעת</div>
                    </div>
                </div>

                <div class="card-body">
                    <div class="card-title">{{ titleForApartment(a) }}</div>
                    <div class="card-details">
                        <div class="detail" *ngFor="let k of visibleKeys(a)">
                            <span class="label">{{ labelForKey(k) }}</span>
                            <span class="value">{{ formatAnswer(a[k]) }}</span>
                        </div>
                    </div>
                    <div class="card-meta"><small>נוצר: {{ a.createdAt || '-' }}</small></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Questions manager modal for adding apartment -->
    <div *ngIf="showAddApartment">
        <app-questions-manager [mode]="'fill-apartment'" [profile]="auth.profile$ | async" (completed)="onApartmentSaved()" (closed)="closeAddApartment()"></app-questions-manager>
    </div>
</section>
